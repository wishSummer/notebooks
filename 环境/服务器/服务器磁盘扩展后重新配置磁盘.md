# 重新分配磁盘资源
> 说明：
> `vmware` 扩展磁盘后，磁盘容量未发生变化。需要对磁盘重新进行容量分区。
> 当前操作存在丢失数据的可能，提前备份好数据。
## 查看当前磁盘状态

```shell
    # 查看当前磁盘状态
    [root@centos nacos]# fdisk -l

    # 当前虚拟机实际磁盘容量 磁盘名称 /dev/sda
    磁盘 /dev/sda：53.7 GB, 53687091200 字节，104857600 个扇区
    Units = 扇区 of 1 * 512 = 512 bytes
    扇区大小(逻辑/物理)：512 字节 / 512 字节
    I/O 大小(最小/最佳)：512 字节 / 512 字节
    磁盘标签类型：dos
    磁盘标识符：0x000908a7

    # 当前磁盘分区
    设备 Boot      Start         End      Blocks   Id  System
    /dev/sda1   *        2048     2099199     1048576   83  Linux
    /dev/sda2         2099200    41943039    19921920   8e  Linux LVM

    # 磁盘分区实际使用容量 (主分区)
    磁盘 /dev/mapper/centos-root：18.2 GB, 18249416704 字节，35643392 个扇区
    Units = 扇区 of 1 * 512 = 512 bytes
    扇区大小(逻辑/物理)：512 字节 / 512 字节
    I/O 大小(最小/最佳)：512 字节 / 512 字节

    # 磁盘分区实际使用容量 (Swap 分区)
    磁盘 /dev/mapper/centos-swap：2147 MB, 2147483648 字节，4194304 个扇区
    Units = 扇区 of 1 * 512 = 512 bytes
    扇区大小(逻辑/物理)：512 字节 / 512 字节
    I/O 大小(最小/最佳)：512 字节 / 512 字节

```

## 重新分配磁盘

```shell
# 开始分区 需要root权限
fdisk /dev/sda

# d 删除
命令(输入 m 获取帮助)：d

# 选择分区
分区号 (1,2,5, 默认  5): 2
分区 2 已删除。

# 仅剩 分区 1  故不需要再次输入分区编号
命令(输入 m 获取帮助)：d
已选择分区 1
分区 1 已删除。

# 创建新分区
命令(输入 m 获取帮助)：n
分区类型
   p   主分区 (0个主分区，0个扩展分区，4空闲)

# 选择主分区 默认分区号 1
选择 (默认 p)：p
分区号 (1-4, 默认  1): 
第一个扇区 (2048-209715199, 默认 2048): 
Last sector, +/-sectors or +/-size{K,M,G,T,P} (2048-209715199, 默认 209715199): 201326591

# 检测到新分区包含原有的 ext4 签名，为避免后续的冲突，选择 y 移除该签名。
分区 #1 包含一个 ext4 签名。
您想移除该签名吗？是[Y]/否[N]：y

# 创建第二个新分区 Swap  分区名称、分区开始扇区以及结束扇区 全选择默认 大小为4 GiB。
命令(输入 m 获取帮助)：n
分区类型
   p   主分区 (1个主分区，0个扩展分区，3空闲)
选择 (默认 p)：p
分区号 (2-4, 默认  2): 
第一个扇区 (201326592-209715199, 默认 201326592): 
Last sector, +/-sectors or +/-size{K,M,G,T,P} (201326592-209715199, 默认 209715199):

# 通过 t 命令将分区 2 的类型更改为 82，表示 Linux swap。
命令(输入 m 获取帮助)：t
分区号 (1,2, 默认  2): 
Hex 代码(输入 L 列出所有代码)：82

# 设置引导分区 使用 a 命令，将分区 1 标记为可引导分区（Bootable）。
命令(输入 m 获取帮助)：a
分区号 (1,2, 默认  2): 1

# 打印分区表，确保分区配置正确：
命令(输入 m 获取帮助)：p

# 写入磁盘 再次操作之前所有操作仅在内存中记录
命令(输入 m 获取帮助)：w
分区表已调整。

# 后续报错属于正常 需要重启服务器对磁盘重新分区
Failed to remove partition 5 from system: 设备或资源忙
Failed to update system information about partition 1: 设备或资源忙
```

# 重启后  调整文件系统大小
> 在调整文件系统大小前，检查文件系统是否存在错误。
> `resize2fs`只适用于 ext2/ext3/ext4 类型的文件系统。
> 磁盘扩展或缩小后才需要使用当前命令
```shell
    # 检查文件系统命令
    e2fsck -f /dev/sda1
    # 调整文件系统大小
    resize2fs /dev/sda1
    # 缩小文件系统命令格式
    resize2fs /dev/sda1 50G

```

## 如何计算需要得到的分区大小 
> 公式： 分区大小 = （终点扇区号 - 起点扇区号 + 1）× 扇区大小
* 分区大小
```shell
    (201326591 - 2048 +1) * 512 = 103079215616 (字节)
```
* 转换为 GiB
```shell
    103079215616 / 1024^3 = 96 (GiB)
```
